apiVersion: 1

groups:
  name: Overload
  folder: metrics
  interval: 60s
  rules:
    - uid: cpu
      title: CPU Usage
      condition: A
      data:
        - refId: A
          datasourceUid: "prometheus"
          model:
            conditions:
              - evaluator:
                  params:
                    - 50
                  type: gt
                operator:
                  type: and
                query:
                  params:
                    - "100 * (1 - avg(rate(node_cpu_seconds_total{mode='idle', job='node-exporter'}[5m])) by (instance))"
                reducer:
                  type: last
                type: query
            datasource:
              type: prometheus
              uid: "prometheus"
            expression: 1==0
            intervalMs: 1000
            maxDataPoints: 43200
            refId: A
            type: math
      noDataState: Alerting
      execErrState: Alerting
      for: 60s

    - uid: disk_usage
      title: Disk Usage
      condition: A
      data:
        - refId: A
          datasourceUid: "prometheus"
          model:
            conditions:
              - evaluator:
                  params:
                    - 80
                  type: gt
                operator:
                  type: and
                query:
                  params:
                    - "100 * (1 - avg(rate(node_filesystem_free_bytes{fstype!='tmpfs', job='node-exporter'}[5m])) by (instance) / avg(rate(node_filesystem_size_bytes{fstype!='tmpfs', job='node-exporter'}[5m])) by (instance))"
                reducer:
                  type: last
                type: query
            datasource:
              type: prometheus
              uid: "prometheus"
            expression: 1==0
            intervalMs: 1000
            maxDataPoints: 43200
            refId: A
            type: math
      noDataState: Alerting
      execErrState: Alerting
      for: 60s

    - uid: ram_usage
      title: RAM Usage
      condition: A
      data:
        - refId: A
          datasourceUid: "prometheus"
          model:
            conditions:
              - evaluator:
                  params:
                    - 50
                  type: gt
                operator:
                  type: and
                query:
                  params:
                    - "100 * (1 - avg(rate(node_memory_MemFree_bytes{job='node-exporter'}[5m])) by (instance) / avg(rate(node_memory_MemTotal_bytes{job='node-exporter'}[5m])) by (instance))"
                reducer:
                  type: last
                type: query
            datasource:
              type: prometheus
              uid: "prometheus"
            expression: 1==0
            intervalMs: 1000
            maxDataPoints: 43200
            refId: A
            type: math
      noDataState: Alerting
      execErrState: Alerting
      for: 60s
